FROM lmsysorg/sglang:v0.4.2.post4-cu124-srt AS builder_stage_0

RUN apt update && apt install tmux netcat -y
ENV NCCL_IB_GID_INDEX=3 NCCL_IB_SL=3 NCCL_CHECK_DISABLE=1 NCCL_P2P_DISABLE=0 NCCL_IB_DISABLE=0 NCCL_LL_THRESHOLD=16384 NCCL_IB_CUDA_SUPPORT=1 NCCL_SOCKET_IFNAME=bond1 UCX_NET_DEVICES=bond1 NCCL_IB_HCA=mlx5_bond_1,mlx5_bond_5,mlx5_bond_3,mlx5_bond_7,mlx5_bond_4,mlx5_bond_8,mlx5_bond_2,mlx5_bond_6 NCCL_COLLNET_ENABLE=0 SHARP_COLL_ENABLE_SAT=0 NCCL_NET_GDR_LEVEL=2 NCCL_IB_QPS_PER_CONNECTION=4 NCCL_IB_TC=160 NCCL_PXN_DISABLE=0
